<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ゲーム</title>

  <script type=module>
  </script>

</head>

<body>
  <div id="question"></div>

  <input type="button" id="button" value="button">

  <canvas id="canvas" width="1000px" , height="1000px"></canvas>
</body>

</html>

<script type=module>

  import { fetchJSON } from "https://js.sabae.cc/fetchJSON.js";

  import main from "./utils/main.js";
  main();

  onload = async () => {

    const {data} = await fetchJSON("/api/events");

    let min = 0;
    let max = 5;

    // シャッフル
    const shuffle = (array) => {
      let currentIndex = array.length;
      let randomIndex;

      while (currentIndex != 0) {

        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;

        // 配列の二つの数字を交換
        [array[currentIndex], array[randomIndex]] = [
          array[randomIndex], array[currentIndex]];
      }

      return array;
    }

    let question = (data, i) =>{
      //alert(data[i].problem);
      let cnt1 = 0;
      let cnt2 = 0;
      let num = 5;

        btn(data[cnt1].problem, cnt1, "question", 0);
        while(cnt2 != data[cnt1].length){
          btn(data[cnt1].items[cnt2].name, cnt2, "answer", data[cnt1].items[cnt2].score);
          cnt2++;
        }
        
    }
    
    let btn = (data, cnt, name, score) =>{
      let createBtn = document.getElementById("question");
      let btn_ele = document.createElement("h2");
      btn_ele.id = name;
      btn_ele.className = "problem"
      btn_ele.textContent= cnt+1 + "." + data;
      btn_ele.onclick = function (){
        if(btn_ele.id == "answer"){
          alert(score);
          let e = document.getElementById("question");
          let j = 0;
          console.log(e.length);
          console.log(e);
          while(e.lastChild){
          e.removeChild(e.lastChild);
        }
        }


      btn(data[cnt1].problem, cnt1, "question", 0);
      while(cnt2 != data[cnt1].length){
        btn(data[cnt1].items[cnt2].name, cnt2, "answer", data[cnt1].items[cnt2].score);
        cnt2++;
      }

  }

  let btn = (data, cnt, name, score) =>{
    let createBtn = document.getElementById("question");
    let btn_ele = document.createElement("h2");
    btn_ele.id = name;
    btn_ele.className = "problem"
    btn_ele.textContent= cnt+1 + "." + data;
    btn_ele.onclick = function (){
      if(btn_ele.id == "answer"){
        alert(score);
        let e = document.getElementById("question");
        let j = 0;
        console.log(e.length);
        console.log(e);
        while(e.lastChild){
        e.removeChild(e.lastChild);
      }
      }
      createBtn.appendChild(btn_ele);

    }


    let flg = false;
    let i = 0;
    shuffle(data);
    question(data,i);
      

    /*for (;;) {
      if (n == 1) {
        //await bg(658);
        alert(data[i].items[0].score);
        alert("GAMEOVER");
        break;
      } else if (n == 2) {
        //await bg(1855);
        alert(data[i].items[1].score);
        alert("GAMEOVER");
        break;
      } else if (n == 3) {
        //await bg(23);
        alert(data[i].items[2].score);
        flg = true;
        break;
      } else {
        break;
      }
    }
    if (flg) {
      //await bg(2583);
      alert("避難所になんとかついた");
      alert("おやすみ");
      alert("TRUE END");
    } else {
      //await bg(3180);
      alert("もう少し慎重に行動しよう");
      alert("THE END");
    }*/

  };
</script>
